# 通用开发规则与最佳实践（AGENTS）

## 1. 通用开发规则
- 需求先行：任何实现前先确认目标、范围、验收标准。
- 单一事实源：状态、配置、规则应有唯一可信来源，避免多处重复定义。
- 职责分离：业务逻辑、状态管理、展示层、持久化分层清晰。
- 小步迭代：每次改动聚焦一个主题，降低回归风险。
- 可回归优先：每次改动都应可验证、可回滚、可追踪。

## 2. 最佳实践
- 代码层面：
- 核心逻辑尽量纯函数化，减少隐式副作用。
- 外部依赖（时间、随机、存储、网络）优先封装，便于测试。
- 复杂逻辑拆分为小函数，避免“巨型函数”。
- 接口层面：
- 对外接口保持稳定，新增字段优先向后兼容。
- 变更公共接口时同步更新文档与调用方。
- 测试层面：
- 功能变更必须同步更新测试。
- 优先覆盖边界条件、失败路径、状态转换路径。
- 文档层面：
- 文档与实现同步维护，不允许长期漂移。
- 对“为什么这样做”给出简明说明，便于后续接手。

## 3. Git 协作规范
- 使用分支开发，避免直接在主线进行高风险改动。
- 提交信息清晰表达意图，推荐 `type: summary` 风格。
- 提交前检查差异范围，确保只包含本次目标改动。
- 合并前完成构建和测试，避免将不可运行代码并入主线。
- 发生冲突时先统一规则与目标，再进行冲突解决。

## 4. 过程注意事项
- 不并行执行会争抢锁的版本控制写操作（如 add/commit/merge）。
- 保持一致编码（推荐 UTF-8），避免跨平台乱码。
- 避免将构建产物、依赖目录、临时缓存纳入版本管理。
- 对命令行环境差异（Shell、路径、权限）保持敏感，必要时分步执行。
- 变更较大时先做最小可行版本，再逐步增强，避免一次性过度改造。

## 5. 发布前检查清单
1. 需求与实现一致，验收标准可执行。
2. 构建通过，关键测试通过。
3. 文档已更新（功能说明、限制、操作方式）。
4. 变更范围清晰，提交记录可追溯。
5. 当前分支工作区干净，可安全合并。
